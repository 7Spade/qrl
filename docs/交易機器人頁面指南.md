# 🌐 QRL 交易機器人 Web 介面指南

> ⚠️ **專案定位說明**
> 
> 本文檔為 QRL 交易機器人的 Web 介面設計指南，針對**當前輕量級實現**提供實用的介面規劃。
> 
> **當前專案**：QRL/USDT 專用交易機器人，使用 EMA 策略進行低風險累積
> 
> 本指南分為兩部分：
> - **第一部分**：當前已實現功能的介面設計（Dash 簡易面板）
> - **第二部分**：未來可選擴展功能參考

---

## 📊 專案規模對照

| 功能 | 當前實現 | 未來擴展 |
|------|---------|---------|
| 交易對 | QRL/USDT 單一幣對 | 多幣對支持 |
| 策略 | EMA20/60 單策略 | 多策略框架 |
| 介面 | 基礎監控面板 | 完整儀表板 |
| 風控 | 倉位限制 | 多層風控 |

---

# 第一部分：當前實現 (v1.0)

## 1️⃣ 儀表板 (已實現)

### 當前功能

Dash 提供的簡易 Web 面板，位於 `web/dash_app.py`

#### **主要顯示資訊**

```
┌─────────────────────────────────────────────┐
│          QRL 交易機器人監控面板              │
├─────────────────────────────────────────────┤
│                                             │
│  交易對: QRL/USDT                           │
│  當前價格: $0.45                            │
│  持倉金額: $250 USDT                        │
│  最後更新: 2025-12-26 10:30:00 UTC         │
│                                             │
└─────────────────────────────────────────────┘
```

**實現代碼** (`web/dash_app.py`):
```python
@app.get("/", response_class=HTMLResponse)
def dashboard(request: Request) -> HTMLResponse:
    """顯示當前 QRL 價格和持倉狀況"""
    # 獲取當前價格
    # 獲取持倉金額
    # 顯示在模板
```

#### **當前端點**

- `GET /` - 主面板（顯示價格、持倉）
- `GET /health` - 健康檢查

### 建議優化（低成本改進）

#### **改進 1：資料更詳細**

```html
┌─────────────────────────────────────────────┐
│          QRL 交易機器人監控面板              │
├─────────────────────────────────────────────┤
│                                             │
│  📈 市場資訊                                 │
│  ├─ 當前價格: $0.45                         │
│  ├─ 24H 漲跌: +2.5%                         │
│  ├─ EMA20: $0.44                            │
│  └─ EMA60: $0.43                            │
│                                             │
│  💰 持倉狀況                                 │
│  ├─ 持倉金額: $250 USDT                     │
│  ├─ 最大倉位: $500 USDT                     │
│  ├─ 使用率: 50%                             │
│  └─ 可用額度: $250 USDT                     │
│                                             │
│  📊 策略狀態                                 │
│  ├─ 策略: EMA20/60 累積策略                 │
│  ├─ 買入條件: 價格 ≤ EMA60 × 1.02          │
│  ├─ 當前狀態: ⚠️ 待買入信號                │
│  └─ 最後下單: 2025-12-25 09:00 UTC         │
│                                             │
│  🔧 系統狀態                                 │
│  ├─ API 連線: ● 正常                        │
│  ├─ 資料延遲: 0.5 秒                        │
│  └─ 最後更新: 2025-12-26 10:30:00 UTC     │
│                                             │
└─────────────────────────────────────────────┘
```

**實現建議**：
```python
@app.get("/", response_class=HTMLResponse)
def dashboard(request: Request) -> HTMLResponse:
    # 獲取市場資料
    ticker = exchange.fetch_ticker(SYMBOL)
    ohlcv = exchange.fetch_ohlcv(SYMBOL, '1d', 100)
    
    # 計算 EMA
    df = calculate_ema(ohlcv)
    ema20 = df['ema20'].iloc[-1]
    ema60 = df['ema60'].iloc[-1]
    
    # 獲取持倉
    position = get_position_usdt()
    
    # 判斷策略狀態
    should_buy_now = should_buy(ohlcv)
    
    return templates.TemplateResponse("dashboard.html", {
        "price": ticker["last"],
        "change_24h": ticker["percentage"],
        "ema20": ema20,
        "ema60": ema60,
        "position": position,
        "max_position": MAX_POSITION_USDT,
        "usage_percent": (position / MAX_POSITION_USDT) * 100,
        "buy_signal": should_buy_now,
        "last_update": datetime.utcnow()
    })
```

#### **改進 2：添加簡單圖表**

使用 Chart.js 或 TradingView Widget:

```html
<!-- 簡單的價格走勢圖 -->
<div id="price-chart"></div>

<script>
// 使用 TradingView 免費 Widget
new TradingView.widget({
  symbol: "MEXC:QRLUSDT",
  interval: "D",
  theme: "light",
  style: "1",
  width: "100%",
  height: 400
});
</script>
```

---

## 2️⃣ 交易記錄（建議添加）

### 簡單實現方案

#### **添加歷史記錄端點**

```python
@app.get("/history")
def trade_history() -> JSONResponse:
    """顯示最近交易記錄"""
    # 從 SQLite 讀取歷史記錄
    # 或從 MEXC API 獲取
    return JSONResponse({
        "trades": [
            {
                "date": "2025-12-25",
                "action": "BUY",
                "price": 0.44,
                "amount": 113.6,
                "cost": 50.0
            },
            # ...
        ]
    })
```

#### **顯示格式**

```
┌─────────────────────────────────────────────┐
│           QRL 交易歷史記錄                   │
├─────────────────────────────────────────────┤
│                                             │
│  日期         動作    價格    數量    成本   │
│  ────────────────────────────────────────  │
│  2025-12-25  買入   $0.44   113.6   $50    │
│  2025-12-20  買入   $0.43   116.3   $50    │
│  2025-12-15  買入   $0.45   111.1   $50    │
│  2025-12-10  買入   $0.42   119.0   $50    │
│                                             │
│  累計買入: 4 次                              │
│  總成本: $200 USDT                          │
│  平均價格: $0.435                           │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 3️⃣ 日誌查看（建議添加）

### 實現方案

#### **日誌端點**

```python
@app.get("/logs")
def system_logs(limit: int = 50) -> JSONResponse:
    """顯示系統日誌"""
    # 讀取 logs/trading.log
    logs = read_recent_logs(limit)
    return JSONResponse({"logs": logs})
```

#### **日誌格式**

```
┌─────────────────────────────────────────────┐
│           系統執行日誌                       │
├─────────────────────────────────────────────┤
│                                             │
│  [2025-12-26 10:30:00] INFO  檢查買入條件   │
│  [2025-12-26 10:30:01] INFO  EMA20: 0.44   │
│  [2025-12-26 10:30:01] INFO  EMA60: 0.43   │
│  [2025-12-26 10:30:01] INFO  價格: 0.45    │
│  [2025-12-26 10:30:02] WARN  條件不成立     │
│  [2025-12-26 09:00:00] INFO  ✅ 掛單完成    │
│  [2025-12-26 09:00:00] INFO  價格: $0.43   │
│  [2025-12-26 09:00:00] INFO  數量: 116.3   │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 4️⃣ 設定頁面（建議添加）

### 基本配置介面

```
┌─────────────────────────────────────────────┐
│           策略參數設定                       │
├─────────────────────────────────────────────┤
│                                             │
│  交易對: QRL/USDT (固定)                    │
│                                             │
│  單筆訂單金額:                               │
│  [____50____] USDT                         │
│                                             │
│  最大持倉限額:                               │
│  [___500____] USDT                         │
│                                             │
│  限價折讓:                                   │
│  [____2_____] %                            │
│                                             │
│  [儲存設定]                                 │
│                                             │
└─────────────────────────────────────────────┘
```

**實現建議**：
- 使用環境變數或配置檔案
- 提供簡單表單修改參數
- 重啟服務後生效

---

# 第二部分：未來擴展參考

> 以下功能為未來可選擴展，當前專案**不需要**實現

## 5️⃣ 進階儀表板（可選）

### 多指標監控

```
┌──────────────────────┬──────────────────────┐
│   資金曲線圖          │   EMA 指標圖          │
│                      │                      │
│   [圖表區域]         │   [圖表區域]         │
│                      │                      │
├──────────────────────┴──────────────────────┤
│   持倉詳情                                   │
│   ┌────────────────────────────────────┐   │
│   │ 買入價格  數量   當前價  浮動盈虧   │   │
│   │ $0.43    116   $0.45    +$2.32    │   │
│   └────────────────────────────────────┘   │
└──────────────────────────────────────────────┘
```

### 績效分析

```
績效統計:
• 累計買入次數: 4 次
• 平均買入價: $0.435
• 當前浮動盈虧: +$1.70 (+0.85%)
• 已實現盈虧: $0 (未賣出)
```

---

## 6️⃣ 告警功能（可選）

### Telegram 通知

```python
def send_telegram_alert(message: str) -> None:
    """發送 Telegram 通知"""
    if TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID:
        import requests
        url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
        requests.post(url, data={
            "chat_id": TELEGRAM_CHAT_ID,
            "text": message
        })

# 使用範例
send_telegram_alert("✅ QRL 買入訂單完成！價格: $0.43, 數量: 116.3")
```

### 告警場景

- ✅ 訂單成交通知
- ⚠️ 接近最大倉位
- ❌ API 連線失敗
- 📊 每日統計報告

---

## 7️⃣ 回測功能（可選）

### 簡單回測介面

```
┌─────────────────────────────────────────────┐
│           策略回測                           │
├─────────────────────────────────────────────┤
│                                             │
│  時間範圍:                                   │
│  從 [2024-01-01] 到 [2025-12-26]           │
│                                             │
│  初始資金: [10000] USDT                     │
│                                             │
│  [開始回測]                                 │
│                                             │
│  ── 回測結果 ──                             │
│  總收益: +$580 (+5.8%)                      │
│  買入次數: 12 次                            │
│  平均買入價: $0.42                          │
│  最終持倉: 1428 QRL                         │
│  持倉價值: $643 (當前價 $0.45)              │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 8️⃣ 多策略支持（可選）

### 策略切換

當需要支持多種策略時（未來擴展）:

```
策略選擇:
• EMA20/60 累積策略 (當前)
• RSI 超賣策略
• 固定時間定投策略
• 自定義策略
```

---

# 實現優先級建議

## ✅ 高優先級（建議實現）

1. **改進儀表板顯示**
   - 添加 EMA 指標顯示
   - 顯示策略狀態
   - 估計成本: 2-4 小時

2. **交易歷史記錄**
   - 顯示過去買入記錄
   - 計算平均成本
   - 估計成本: 3-5 小時

3. **系統日誌查看**
   - Web 端查看日誌
   - 無需 SSH 登入
   - 估計成本: 2-3 小時

## 🔶 中優先級（可選實現）

4. **Telegram 通知**
   - 訂單成交通知
   - 系統異常告警
   - 估計成本: 3-4 小時

5. **簡單設定介面**
   - Web 端修改參數
   - 無需修改代碼
   - 估計成本: 4-6 小時

## 🔵 低優先級（未來考慮）

6. **回測功能**
   - 歷史數據回測
   - 策略驗證
   - 估計成本: 8-12 小時

7. **績效分析**
   - 圖表視覺化
   - 詳細統計
   - 估計成本: 6-10 小時

---

# 技術實現建議

## 前端技術棧

**當前使用**：
- Dash (後端)
- Jinja2 (模板)
- 基礎 HTML/CSS

**建議優化**：
```html
<!-- 添加基礎 UI 框架 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- 添加圖表庫 (可選) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- 或使用 TradingView Widget -->
<script src="https://s3.tradingview.com/tv.js"></script>
```

## 資料存儲

**當前**：
- SQLite (僅存儲持倉)

**建議擴展**：
```python
# 添加交易歷史表
CREATE TABLE trades (
    id INTEGER PRIMARY KEY,
    timestamp TEXT,
    action TEXT,  -- 'BUY' or 'SELL'
    price REAL,
    amount REAL,
    cost REAL,
    strategy TEXT
);

# 添加日誌表 (可選，或直接讀取文件)
CREATE TABLE logs (
    id INTEGER PRIMARY KEY,
    timestamp TEXT,
    level TEXT,
    message TEXT
);
```

## API 端點規劃

```python
# 當前端點
GET  /          # 主面板
GET  /health    # 健康檢查

# 建議新增
GET  /api/market      # 市場數據
GET  /api/position    # 持倉狀況
GET  /api/trades      # 交易歷史
GET  /api/logs        # 系統日誌
POST /api/config      # 更新配置
GET  /api/backtest    # 回測 (可選)
```

---

# 與規範指南的對應關係

## 對應表

| 規範指南章節 | 當前實現 | 頁面指南對應 |
|-------------|---------|-------------|
| 1. 架構設計 | 簡單模組化 | 第一部分 |
| 2. 核心設計模式 | 函數式設計 | 第一部分 |
| 3. 系統分層 | 基礎分層 | 第一部分 1-4 節 |
| 4. 策略設計 | 單一 EMA 策略 | 第二部分 8 節 |
| 5. 風控體系 | 簡單倉位限制 | 第一部分 1 節 |
| 6. 資料流管理 | 直接 API | - |
| 7. 監控告警 | 基礎監控 | 第一部分 + 第二部分 6 節 |
| 8. 部署維運 | Cloud Run | - |

## 衝突解決

**無衝突**：
- 規範指南是通用參考架構
- 頁面指南是具體實現建議
- 兩者互補，不衝突

**使用建議**：
1. 當前開發：參考「頁面指南」第一部分
2. 未來擴展：參考「頁面指南」第二部分
3. 架構理解：參考「規範指南」

---

# 總結

## 當前專案 Web 介面現狀

✅ **已有**：
- 基礎監控面板（價格、持倉）
- 健康檢查端點

⚠️ **建議優化**：
- 改進儀表板（添加 EMA、策略狀態）
- 添加交易歷史記錄
- 添加系統日誌查看

🔮 **未來可選**：
- Telegram 通知
- Web 端設定介面
- 回測功能
- 績效分析

## 開發建議

1. **第一階段**：優化當前面板（高優先級項目）
2. **第二階段**：添加 Telegram 通知（提升體驗）
3. **第三階段**：視需求添加其他功能

## 參考文檔

- **當前實現**：參考本文檔第一部分
- **架構理解**：參考「交易機器人完整規範指南.md」
- **代碼標準**：參考「DEVELOPMENT.md」

---

**文檔版本**: v1.0
**最後更新**: 2025-12-26
**適用專案**: QRL Trading Bot (Personal Project Scale)
