# QRL äº¤æ˜“æ©Ÿå™¨äºº - å¿«é€Ÿé–‹å§‹

## ğŸ“‹ å‰ç½®éœ€æ±‚

- Python 3.9+
- MEXC äº¤æ˜“æ‰€ API é‡‘é‘°
  - åœ¨æ­¤å»ºç«‹ API é‡‘é‘°ï¼šhttps://www.mexc.com/user/openapi
  - MEXC æä¾›å…©å€‹æ†‘è­‰ï¼š
    - **Access Keyï¼ˆå­˜å–é‡‘é‘°ï¼‰** - åœ¨ .env ä¸­è¨­å®šç‚º MEXC_API_KEY
    - **Secret Keyï¼ˆå¯†é‘°ï¼‰** - åœ¨ .env ä¸­è¨­å®šç‚º MEXC_API_SECRET
  - å•Ÿç”¨ã€Œç¾è²¨äº¤æ˜“ã€æ¬Šé™
  - è‹¥ä½¿ç”¨å­å¸³æˆ¶äº¤æ˜“ï¼Œè«‹åœ¨ `.env` ä¸­æŒ‡å®šå­å¸³æˆ¶åç¨±
- åŸºæœ¬çš„åŠ å¯†è²¨å¹£äº¤æ˜“çŸ¥è­˜
- ï¼ˆé¸ç”¨ï¼‰Google Cloud å¸³æˆ¶ç”¨æ–¼ Cloud Run éƒ¨ç½²

## ğŸš€ æœ¬åœ°é–‹ç™¼

### 1. å®‰è£

```bash
git clone https://github.com/7Spade/qrl.git
cd qrl
pip install -r requirements.txt
```

### 2. è¨­å®š

```bash
cp .env.example .env
# ç·¨è¼¯ .env å¡«å…¥ MEXC API é‡‘é‘°
# å¾æ­¤è™•å–å¾— API é‡‘é‘°ï¼šhttps://www.mexc.com/user/openapi
#
# MEXC API æ†‘è­‰ï¼š
#   - MEXC_API_KEY: æ‚¨çš„ MEXC Access Keyï¼ˆå­˜å–é‡‘é‘°ï¼‰
#   - MEXC_API_SECRET: æ‚¨çš„ MEXC Secret Keyï¼ˆå¯†é‘°ï¼‰
#   - MEXC_SUBACCOUNT:ï¼ˆé¸å¡«ï¼‰å­å¸³æˆ¶åç¨±
```

**é‡è¦**ï¼šMEXC åœ¨æ‚¨å»ºç«‹ API æ†‘è­‰æ™‚æœƒæä¾›ã€ŒAccess Keyã€å’Œã€ŒSecret Keyã€ã€‚
- ä½¿ç”¨ **Access Key** ä½œç‚º `MEXC_API_KEY`
- ä½¿ç”¨ **Secret Key** ä½œç‚º `MEXC_API_SECRET`

### 3. åŸ·è¡Œ

```bash
# åŸ·è¡Œäº¤æ˜“æ©Ÿå™¨äºº
python main.py

# å•Ÿå‹•ç›£æ§é¢æ¿
uvicorn web.app:app --reload
```

## â˜ï¸ Google Cloud Run éƒ¨ç½²

```bash
# ä½¿ç”¨ Cloud Build éƒ¨ç½²ï¼ˆé è¨­ç‚ºå…¬é–‹å­˜å–ï¼‰
gcloud builds submit --config cloudbuild.yaml
```

éƒ¨ç½²éç¨‹æœƒè‡ªå‹•è¨­å®šå…¬é–‹å­˜å–ã€‚IAM æ”¿ç­–ç¶å®šå·²åŒ…å«åœ¨ Cloud Build é…ç½®ä¸­ã€‚

**æ³¨æ„**ï¼šéƒ¨ç½²å¾Œå¯èƒ½éœ€è¦ 30-60 ç§’æœå‹™æ‰èƒ½å®Œå…¨å¯å­˜å–ã€‚

### é¸ç”¨ï¼šåˆ‡æ›åˆ° IAM èº«ä»½é©—è­‰

å¦‚æœæ‚¨æƒ³é™åˆ¶åªæœ‰æˆæ¬Šä½¿ç”¨è€…å¯ä»¥å­˜å–ï¼š

```bash
# ç§»é™¤å…¬é–‹å­˜å–
gcloud run services remove-iam-policy-binding qrl-bot \
  --region=asia-east1 \
  --member="allUsers" \
  --role="roles/run.invoker"

# æˆäºˆç‰¹å®šä½¿ç”¨è€…å­˜å–æ¬Šé™
gcloud run services add-iam-policy-binding qrl-bot \
  --region=asia-east1 \
  --member="user:your-email@gmail.com" \
  --role="roles/run.invoker"
```

**å­˜å–éœ€è¦ IAM é©—è­‰çš„æœå‹™ï¼š**

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ gcloud auth å–å¾— token ä¸¦é€é curl å­˜å–
TOKEN=$(gcloud auth print-identity-token)
curl -H "Authorization: Bearer $TOKEN" https://qrl-bot-545492969490.asia-east1.run.app/

# æ–¹æ³• 2ï¼šé€éç€è¦½å™¨å­˜å–ï¼ˆæœƒæç¤º Google èº«ä»½é©—è­‰ï¼‰
# åœ¨æˆäºˆè‡ªå·±å­˜å–æ¬Šé™å¾Œï¼Œç›´æ¥é–‹å•Ÿ URL å³å¯
```

## ğŸ“Š äº¤æ˜“ç­–ç•¥

**è²·å…¥æ¢ä»¶**ï¼ˆéœ€åŒæ™‚æ»¿è¶³ï¼‰ï¼š
1. åƒ¹æ ¼ â‰¤ EMA60 Ã— 1.02ï¼ˆæ¥è¿‘æ”¯æ’ä½ï¼‰
2. EMA20 â‰¥ EMA60ï¼ˆæ­£å‘å‹•èƒ½ï¼‰

**é¢¨éšªæ§åˆ¶**ï¼š
- å–®ç­†è¨‚å–®ï¼š50 USDT
- æœ€å¤§å€‰ä½ï¼š500 USDT
- é™åƒ¹æŠ˜è®“ï¼š2%

## âš™ï¸ åƒæ•¸è¨­å®š

ä¿®æ”¹ `config.py`ï¼š

| åƒæ•¸ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `SYMBOL` | `QRL/USDT` | äº¤æ˜“å° |
| `BASE_ORDER_USDT` | `50` | å–®ç­†é‡‘é¡ |
| `MAX_POSITION_USDT` | `500` | æœ€å¤§å€‰ä½ |
| `PRICE_OFFSET` | `0.98` | é™åƒ¹æŠ˜æ‰£ |

## ğŸ”„ è‡ªå‹•åŸ·è¡Œ

**Cronï¼ˆLinux/Macï¼‰**ï¼š
```bash
0 9 * * * cd /path/to/qrl && python3 main.py >> logs/bot.log 2>&1
```

**Cloud Schedulerï¼ˆCloud Runï¼‰**ï¼š
```bash
gcloud scheduler jobs create http qrl-trader \
  --schedule="0 9 * * *" \
  --uri="YOUR_CLOUD_RUN_URL/trade" \
  --http-method=POST
```

## ğŸ› å¸¸è¦‹å•é¡Œ

### æœ¬åœ°å•é¡Œ

**æ¨¡çµ„éŒ¯èª¤**ï¼š`pip install -r requirements.txt`

**è³‡æ–™åº«éŒ¯èª¤**ï¼š`rm -rf data/ && python main.py`

**API éŒ¯èª¤**ï¼šæª¢æŸ¥ `.env` ä¸­çš„ API é‡‘é‘°

### Cloud Run å•é¡Œ

**403 Forbidden éŒ¯èª¤**ï¼š

æ­¤éŒ¯èª¤è¡¨ç¤ºæœå‹™ä¸å…è¨±æœªç¶“é©—è­‰çš„å­˜å–ã€‚æœ‰å…©ç¨®è§£æ±ºæ–¹æ¡ˆï¼š

**è§£æ±ºæ–¹æ¡ˆ 1ï¼šå•Ÿç”¨å…¬é–‹å­˜å–ï¼ˆç”¨æ–¼é–‹ç™¼/æ¸¬è©¦ï¼‰**

```bash
# æˆäºˆæœå‹™å…¬é–‹å­˜å–æ¬Šé™
gcloud run services add-iam-policy-binding qrl-bot \
  --region=asia-east1 \
  --member="allUsers" \
  --role="roles/run.invoker"

# é©—è­‰æ”¿ç­–å·²è¨­å®š
gcloud run services get-iam-policy qrl-bot --region=asia-east1
```

**è§£æ±ºæ–¹æ¡ˆ 2ï¼šä½¿ç”¨ IAM èº«ä»½é©—è­‰ï¼ˆå»ºè­°ç”¨æ–¼æ­£å¼ç’°å¢ƒï¼‰**

```bash
# æˆäºˆè‡ªå·±å­˜å–æ¬Šé™
gcloud run services add-iam-policy-binding qrl-bot \
  --region=asia-east1 \
  --member="user:your-email@gmail.com" \
  --role="roles/run.invoker"

# é€éç€è¦½å™¨ä»¥èº«ä»½é©—è­‰æ–¹å¼å­˜å–
# æˆ–ä½¿ç”¨å¸¶æœ‰é©—è­‰ token çš„ curlï¼š
TOKEN=$(gcloud auth print-identity-token)
curl -H "Authorization: Bearer $TOKEN" https://your-service-url.run.app/
```

**ç†è§£ 403 éŒ¯èª¤**ï¼š

Google Cloud Run éœ€è¦æ˜ç¢ºçš„ IAM æ¬Šé™æ‰èƒ½å­˜å–æœå‹™ï¼š
- **å…¬é–‹å­˜å–**ï¼šéœ€è¦ `allUsers` æ“æœ‰ `run.invoker` è§’è‰²
- **èº«ä»½é©—è­‰å­˜å–**ï¼šéœ€è¦ç‰¹å®šä½¿ç”¨è€…/æœå‹™å¸³æˆ¶æ“æœ‰ `run.invoker` è§’è‰²
- éƒ¨ç½²æ™‚çš„ `--allow-unauthenticated` æ——æ¨™æœƒè¨­å®šå…¬é–‹å­˜å–æ”¿ç­–
- å¦‚æœéƒ¨ç½²ä¸åŒ…å«æ­¤æ——æ¨™æˆ– IAM æ”¿ç­–ï¼Œæ‚¨æœƒæ”¶åˆ° 403 éŒ¯èª¤

**æˆ‘æ‡‰è©²ä½¿ç”¨å“ªç¨®é©—è­‰æ¨¡å¼ï¼Ÿ**

| æ¨¡å¼ | ä½¿ç”¨æƒ…å¢ƒ | å®‰å…¨æ€§ | æŒ‡ä»¤ |
|------|---------|--------|------|
| **å…¬é–‹** | é–‹ç™¼ã€æ¸¬è©¦ã€å…¬é–‹å„€è¡¨æ¿ | ä½ - ä»»ä½•äººéƒ½å¯å­˜å– | `--allow-unauthenticated` |
| **IAM é©—è­‰** | æ­£å¼ç’°å¢ƒã€æ•æ„Ÿè³‡æ–™ | é«˜ - åªæœ‰æˆæ¬Šä½¿ç”¨è€… | `--no-allow-unauthenticated` |

**403 éŒ¯èª¤ç–‘é›£æ’è§£ï¼š**

1. æª¢æŸ¥ç›®å‰çš„ IAM æ”¿ç­–ï¼š
```bash
gcloud run services get-iam-policy qrl-bot --region=asia-east1
```

2. å¦‚æœæ‚¨çœ‹åˆ° `allUsers` å…·æœ‰ `roles/run.invoker`ï¼Œæœå‹™æ˜¯å…¬é–‹çš„
3. å¦‚æœæ‚¨æ²’çœ‹åˆ° `allUsers`ï¼Œæœå‹™éœ€è¦èº«ä»½é©—è­‰
4. éƒ¨ç½²å¾Œç­‰å¾… 30-60 ç§’è®“æ”¿ç­–å‚³æ’­

**é€£æ¥åŸ å•é¡Œ**ï¼š
- Cloud Run ä½¿ç”¨ PORT ç’°å¢ƒè®Šæ•¸ï¼ˆå·²åœ¨ Dockerfile ä¸­é…ç½®ï¼‰
- ç¢ºèª cloudbuild.yaml ä¸­æœ‰è¨­å®š `--port 8080`

**éƒ¨ç½²å¤±æ•—**ï¼š
```bash
# æŸ¥çœ‹æ—¥èªŒ
gcloud run services logs read qrl-bot --region=asia-east1

# é‡æ–°éƒ¨ç½²
gcloud builds submit --config cloudbuild.yaml
```

## âš ï¸ é¢¨éšªæç¤º

**åŠ å¯†è²¨å¹£äº¤æ˜“å…·æœ‰é«˜é¢¨éšªï¼**æœ¬æ©Ÿå™¨äººåƒ…ä¾›å­¸ç¿’ä½¿ç”¨ï¼Œä¸ä¿è­‰ç²åˆ©ã€‚åªä½¿ç”¨å¯æ‰¿å—æå¤±çš„è³‡é‡‘ã€‚

---

**å…è²¬è²æ˜**ï¼šåƒ…ä¾›æ•™è‚²ç”¨é€”ï¼Œä½¿ç”¨é¢¨éšªè‡ªè² ã€‚
